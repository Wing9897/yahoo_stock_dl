# 股票數據下載器 - 完整系統

Yahoo Finance股票數據下載工具，提供三種使用方式：網頁版和兩種桌面版GUI。

## 📦 版本選擇

### 🌐 網頁版 - `stock_downloader.html` (最方便)
- **無需安裝** - 直接用瀏覽器開啟即可使用
- **跨平台** - Windows、Mac、Linux皆可使用
- **進階功能** - 支援盤前盤後數據(includePrePost)
- **即時驗證** - 自動檢測並提示日期範圍錯誤
- **適用於** - 快速使用、無需安裝Python環境

### 🔧 Tkinter版本 - `stock_gui_tkinter.py`
- **輕量級** - 使用Python內建GUI庫
- **快速啟動** - 無需額外依賴PyQt6
- **基本功能** - 包含所有核心功能
- **適用於** - 快速使用或系統資源有限的環境

### 🎨 Qt6版本 - `stock_gui_qt6.py` (桌面版推薦)
- **現代化界面** - 美觀的用戶體驗
- **完全可縮放** - 支援任意窗口大小調整
- **智能主題** - 自動跟隨系統深色/淺色模式
- **增強功能** - 菜單欄、設置保存、主題切換、重試機制
- **適用於** - 日常使用或需要更好體驗的場景

## 🚀 功能特點

### 📊 支援多種時間間隔
- 1分鐘 (1m) - 適用於短期交易分析
- 2分鐘 (2m)
- 5分鐘 (5m)
- 15分鐘 (15m)
- 30分鐘 (30m)
- 1小時 (60m/1h)
- 1天 (1d) - 預設值
- 1週 (1wk)
- 1個月 (1mo)

### 🌍 支援多個股票市場
- **美國** (USD): AAPL, MSFT, GOOGL
- **台灣** (TWD): 2330.TW, 2317.TW
- **香港** (HKD): 0700.HK, 0005.HK
- **日本** (JPY): 7203.T, 6758.T
- **德國** (EUR): SAP.DE, VOW3.DE
- **英國** (GBP): BARC.L, LLOY.L

### 💾 多種輸出格式
- **CSV** - 逗號分隔值，適合 Excel 和其他工具
- **Excel** - .xlsx 格式，支援多工作表
- **JSON** - 標準JSON格式(網頁版)
- **SQLite** - 關聯式資料庫，同一個 db 檔案包含多個股票表格

### 📊 統一資料格式
**所有時間間隔均使用完整時間戳格式：**
- **Symbol** - 股票代號
- **Date** - YYYY-MM-DD HH:MM:SS 格式時間戳
- **Open** - 開盤價
- **High** - 最高價
- **Low** - 最低價
- **Close** - 收盤價
- **Volume** - 成交量(交易股數)

### 🔧 核心功能
- ✅ 多股票同時下載（用逗號分隔）
- ✅ 每隻股票獨立儲存
- ✅ 即時進度條顯示
- ✅ 詳細下載日誌
- ✅ 📅 日曆選擇器（Qt6版本）
- ✅ 可停止/暫停下載
- ✅ 輸出目錄選擇

### 🎨 Qt6版本專屬功能
- ✅ **完全可縮放界面** - 從最小化到全屏
- ✅ **智能主題系統** - 自動跟隨系統主題
- ✅ **🌓 三種主題模式** - 自動/淺色/深色
- ✅ **設置持久化** - 自動保存窗口大小和偏好
- ✅ **專業菜單欄** - 完整的應用程序體驗

## 📋 安裝要求

```bash
pip install -r requirements.txt
```

## 🎯 快速開始

### 網頁版（無需安裝）
直接用瀏覽器開啟：
```
stock_downloader.html
```

### 運行Tkinter版本（輕量）
```bash
python stock_gui_tkinter.py
```

### 運行Qt6版本（桌面版推薦）
```bash
python stock_gui_qt6.py
```

## 📖 使用步驟

1. **選擇版本** - 根據需求選擇合適的版本
2. **設定參數**：
   - 輸入股票代號（多個用逗號分隔）
   - 選擇股票市場
   - 設定時間間隔
   - 📅 選擇日期範圍（Qt6版本有日曆選擇器）
   - 選擇輸出格式和目錄
3. **開始下載** - 點擊「開始下載」按鈕

## 股票代號格式

### 美國股票
直接輸入股票代號：`AAPL, MSFT, GOOGL`

### 台灣股票
需要加上 .TW 後綴：`2330.TW, 2317.TW, 2454.TW`

### 香港股票
需要加上 .HK 後綴：`0700.HK, 0005.HK, 0001.HK`

### 日本股票
需要加上 .T 後綴：`7203.T, 6758.T, 9984.T`

## 輸出檔案說明

### CSV/Excel 格式
每隻股票會產生獨立的檔案：
- `AAPL_data.csv`
- `2330_TW_data.xlsx`

### SQLite 格式
所有股票儲存在同一個資料庫檔案 `stock_data.db` 中：
- 表格名稱：`stock_AAPL`, `stock_2330_TW` 等
- 每個表格包含該股票的所有歷史數據

## 資料欄位

下載的資料包含以下欄位：
- **Date** - 日期（索引）
- **Open** - 開盤價
- **High** - 最高價
- **Low** - 最低價
- **Close** - 收盤價
- **Volume** - 成交量
- **Dividends** - 股息
- **Stock Splits** - 股票分割

## ⚠️ Yahoo Finance API 限制

**重要：請嚴格遵守以下時間範圍限制，否則會收到HTTP 422錯誤**

| 時間間隔 | 最大範圍 | 時間窗口 | 說明 |
|---------|---------|---------|------|
| 1m | 7天 | 最近30天內 | 1分鐘數據：日期範圍≤7天，且必須在最近30天內 |
| 2m, 5m, 15m, 30m | 59天 | 最近60天內 | 分鐘數據：日期範圍≤59天，且必須在最近60天內 |
| 60m, 1h | 729天 | 最近729天內 | 1小時數據：約2年數據 |
| 1d, 5d, 1wk, 1mo, 3mo | 無限制 | 無限制 | 日線以上數據無時間限制 |

**範例說明：**
- ✅ 正確：2m間隔，2025-08-01至2025-09-28（58天，在60天窗口內）
- ❌ 錯誤：2m間隔，2025-08-01至2025-09-29（60天，超過59天限制）
- ❌ 錯誤：2m間隔，2025-06-01至2025-07-15（45天，但不在最近60天窗口內）

## 注意事項

1. **時間間隔限制**：
   - 請參考上方「Yahoo Finance API 限制」表格
   - 超出限制將返回HTTP 422錯誤
   - 系統會自動驗證並提示錯誤範圍

2. **市場時間**：
   - 數據僅在相應市場交易時間內更新
   - 假日和非交易日不會有新數據

3. **網路連線**：
   - 需要穩定的網路連線
   - 網頁版使用CORS代理(corsproxy.io)
   - 大量數據下載可能需要較長時間

4. **檔案權限**：
   - 確保輸出目錄有寫入權限
   - SQLite 檔案需要讀寫權限

## 疑難排解

### 常見錯誤

#### HTTP 422 Unprocessable Entity
- **原因**：違反Yahoo Finance API時間限制
- **解決**：檢查日期範圍是否符合上方「API限制」表格
- **範例**：2m間隔只能選擇最近60天內的59天範圍

#### 股票代號不存在
- **檢查**：代號格式和市場後綴是否正確
- **常見錯誤**：APPL → 正確應為AAPL

#### 日期範圍錯誤
- **確保**：開始日期早於結束日期
- **確保**：日期範圍在API限制內

#### 輸出目錄不存在
- **解決**：選擇有效的輸出目錄
- **權限**：確保目錄有寫入權限

### 效能最佳化
- 避免同時下載過多股票
- 較短時間間隔會增加下載時間
- 使用 SQLite 格式可減少檔案數量

## 📚 使用範例

### 範例1：下載台積電近一週分鐘數據
```
股票代號：2330.TW
時間間隔：5m
開始日期：2025-09-23
結束日期：2025-09-30
輸出格式：CSV
```

### 範例2：下載多支美股日線數據
```
股票代號：AAPL, MSFT, GOOGL
時間間隔：1d
開始日期：2024-01-01
結束日期：2025-09-30
輸出格式：SQLite (所有股票存在同一個stock_data.db)
```

### 範例3：下載小時數據(最多729天)
```
股票代號：0700.HK
時間間隔：1h
開始日期：2023-10-01
結束日期：2025-09-30
輸出格式：Excel
```

## 🔄 版本歷史

### v3.0 (2025-09) - 統一格式更新
- ✅ 統一所有時間間隔輸出格式為 YYYY-MM-DD HH:MM:SS
- ✅ 新增Symbol欄位到所有輸出格式
- ✅ 修正60m時間間隔限制(60天→730天)
- ✅ 更新Yahoo Finance API限制驗證(59/729天)
- ✅ 新增雙層驗證：範圍檢查+時間窗口檢查
- ✅ 改進HTTP 422錯誤處理和提示訊息
- ✅ 三個版本(HTML/Qt6/Tkinter)完全同步

### v2.0 - 多版本支援
- ✅ 新增網頁版(無需安裝Python)
- ✅ Qt6版本加入深色模式
- ✅ Tkinter版本優化界面
- ✅ 支援JSON輸出格式

### v1.0 - 初始版本
- ✅ 基本股票數據下載功能
- ✅ 支援CSV/Excel/SQLite格式
- ✅ 多股票同時下載

## 📞 常見問題

**Q: Volume是什麼意思？**
A: Volume是成交量，表示在該時間段內交易的股票數量。數值越大表示交易越活躍。

**Q: 為什麼1分鐘數據只能下載7天？**
A: 這是Yahoo Finance API的限制，分鐘級數據因為資料量大，所以有時間限制。

**Q: 可以下載盤前盤後數據嗎？**
A: 網頁版支援includePrePost選項，可以包含盤前盤後交易數據。

**Q: 為什麼所有時間間隔都顯示完整時間戳？**
A: 從v3.0開始，為了保持資料格式統一性，所有時間間隔都使用完整的YYYY-MM-DD HH:MM:SS格式，方便資料處理和比對。

**Q: HTTP 422錯誤如何解決？**
A: 檢查您選擇的日期範圍是否符合該時間間隔的API限制，詳見上方「Yahoo Finance API限制」表格。

## 📄 授權

本專案僅供學習和個人使用。使用Yahoo Finance數據請遵守其服務條款。